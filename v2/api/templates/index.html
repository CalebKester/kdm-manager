<!doctype html>
<html ng-app="theWatcher" ng-controller="globalController">
 <title>http://thewatcher.io - The Watcher - {{ settings.application.title }}</title>
 <head>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-71038485-2', 'auto');
      ga('send', 'pageview');
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
    <script src="http://code.angularjs.org/1.5.3/angular-route.min.js"></script>
    <script src="/static/js/app.js"></script>
    <link rel="stylesheet" href="/static/css/style.css" />
 </head>


 <body>

    <h1>{{ settings.application.app_name }}</h1>
    <h2>{{ settings.application.title }}</h2>
    <h3> API Version {{ settings.api.version }}</h3>


    <table class="api_documentation public_routes">
        <tr><th colspan="3">PUBLIC ROUTES</th></tr>
        <tr>
            <td colspan="3">
                <p>
                    These routes <b>DO NOT</b> require authentication. Use them
                    to construct dashboard, "create new whatever" type views and
                    to look up game asset data that does not belong to any user.
                </p>
            </td>
        </tr>

        <tr class="ul">
            <th class="route">Route</th><th class="methods">Methods</th><th class="comment">Comment/Note</th>
        </tr>


        <tr class="">
            <td> <a href="/campaign">/campaign</a> </td>
            <td> POST </td>
            <td>
                <p>Accepts a "name" or "handle" parameter included in the body
                of the request (which should be JSON) and returns a JSON
                representation of the campaign:</p>
                <code>{"name": "People of the Lantern"}</code>
                <p>...gets you something like this:</p>
                <code>{"handle": "people_of_the_lantern","milestones":
                ["first_child", "first_death", "pop_15", "innovations_5",
                "game_over" ], "saviors": "1.3.1", "name": "People of the Lantern",
                "default": true, "principles": ["new_life", "death", "society",
                "conviction"], "always_available": { "location": ["Lantern
                Hoard"], "innovation": ["Language"]},"nemesis_monsters": [
                "butcher", "kings_man","the_hand","watcher"],"quarries": [
                "white_lion","screaming_antelope","phoenix", "beast_of_sorrow",
                "great_golden_cat", "mad_steed", "golden_eyed_king"],"type":
                "campaign_definition"}</code>
                <p>NB: this also works with handles, e.g.:</p>
                <code>{"handle": "people_of_the_stars"}</code>
            </td>
        </tr>

        <tr class="ul">
            <td> <a href="/login">/login</a> </td>
            <td> POST </td>
            <td>
                <p>        
                    The KD:M API uses JSON Web Tokens (<a
                    href="https://jwt.io/">https://jwt.io</a>) to manage user
                    sessions and user authentication.
                </p>
                <p> POST to this route with JSON containing user credentials in
                the body of the request to get a token:</p>
                <code>Authorization: {"username": "demo@kdm-manager.com", "password": 
                "l33th4x0r"}</code>
                <p>...if your credential checks out, you get a token and the the
                the user's ID (see below for working with users) back. Easy!</p>
            </td>
        </tr>

        <tr class="ul">
            <td> <a href="/monster">/monster</a> </td>
            <td> POST </td>
            <td>
                <p>
                    Accepts a "name" or "handle" parameter (via JSON) and
                    returns a JSON representation of a monster type game asset.
                    For example, POSTing to /monster with JSON such as this:
                </p>
                <code>{"name": "White Lion Lvl. 1"}</code>
                <p>...returns JSON like this: </p>
                <code>{"comment": "Lvl. 1", "handle": "white_lion", "name":
                "White Lion", "level": 1, "levels": 3, "sort_order": 0, "type":
                "quarry"}
                <p>Or, with a handle:</p>
                <code>{"handle": "manhunter"}</code>
                <p>...you get:</p>
                <code>{"handle": "manhunter", "name": "Manhunter", "levels": 4,
                "sort_order": 103, "type": "nemesis", "selectable": false, 
                "misspellings": ["THE MANHUNTER", "MAN HUNTER"]}
                </code>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/new_settlement">/new_settlement</a></td>
            <td> GET </td>
            <td> Returns JSON representing available options for creating a new
            settlement, including expansions, pre-fab survivors, etc. Also
            includes subtitle/description elements. Use this to make "create
            new settlement" type views. </td>
        </tr>
        <tr class="ul">
            <td> <a href="/settings.json">/settings.json</a> </td>
            <td> GET</td>
            <td> Not strictly a part of the API, but sometimes useful. Hit this
            route to download an attachement of settings.cfg as JSON. </td>
        </tr>
        <tr class="ul">
            <td> <a href="/settings">/settings</a> </td>
            <td> GET </td>
            <td> Retrieve settings.cfg as JSON</td>
        </tr>
        <tr class="ul">
            <td> <a href="/world">/world</a> </td>
            <td> GET </td>
            <td> Retrieve a JSON representation of aggregate/world stats.</td>
        </tr>
    </table>


    <table class="api_documentation private_routes">
        <tr><th colspan="3">PRIVATE ROUTES</th></tr>
        <tr>
            <td colspan="3">
                <p>
                    Private routes require authentication via JWT (see above).
                </p>
            </td>
        </tr>

        <tr class="ul">
            <th class="route">Route</th><th class="methods">Methods</th><th class="comment">Comment/Note</th>
        </tr>

        <tr class="ul route_root">
            <th colspan="3"><b>User Routes:</b> all routes for working directly with a user follow a <code>/user/&lt;action&gt;/&lt;settlement_id&gt;</code> convention. These routes are private and require authentication.</th>
        </tr>
        <tr class="ul">
            <td> /user/get/&lt;user_id&gt; </td>
            <td> GET </td>
            <td> Retrieve a serialized version of the user who owns &lt;user_id&gt;,
            to include some additional usage and meta facts about that user. </td>
        </tr>
        <tr class="ul">
            <td> /user/set/&lt;user_id&gt; </td>
            <td> POST, OPTIONS </td>
            <td> <p>This route supports the assignment of user-specified key/value
            attributes to the user object.</p><p>To set an attribute, include
            JSON in the body of the request that indicates the key/value to set.</p>
            Supported attribute keys include:
                <table class="embedded_table">
                    <tr><th>key</th><th>value</th></tr>
                    <tr><td class="key">current_settlement</td><td class="value">
                    OID of an existing,non-removed settlement.</td></tr>
                </table>
            Use multiple key/value pairs to set multiple attributes in a single
            request, e.g. <code>{"current_settlement": $oid, "current_session":
            $oid}</code>
            </p>
            <p><b>Important!</b> This route does not support the assignment of
            arbitrary keys and will completely fail any request that includes
            unsupported keys!</p>
            </td>
        </tr>


        <tr class="ul route_root">
            <th colspan="3"><b>Settlement Routes:</b> all routes for working directly with a settlement follow a <code>/settlement/&lt;action&gt;/&lt;settlement_id&gt;</code> convention. These routes are private and require authentication. </th>
        </tr>
        <tr class="ul">
            <td> /settlement/get/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td> Retrieve a serialized version of the settlement associated with
            &lt;settlement_id&gt; (to include all related user and game assets, including survivors).</td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_event_log/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td> Retrieve all settlement event log entries (in a giant hunk of JSON).</td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_innovation_deck/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td> Retrieve the settlement's current innovation deck (as an array).</td>
        </tr>


        <tr class="ul route_root">
            <th colspan="3"><b>Survivor Routes:</b> all routes for working directly with an individual survivor follow a <code>/settlement/&lt;action&gt;/&lt;settlement_id&gt;</code> convention. Like settlement routes, these routes are private and require authentication. </th>
        </tr>

        <tr class="ul">
            <td> /settlement/get/&lt;survivor_id&gt; </td>
            <td> GET </td>
            <td> Retrieve a serialized version of the survivor.</td>
        </tr>

    </table>


 </body>
</html>
